<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mis Pólizas - SegurApp</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/usuarios/polizasUsuarios.css}"/>
</head>

<body>
  <aside class="sidebar">
    <nav>
      <ul>  
        <li><a th:href="@{dashboard}">Inicio</a></li>
        <li><a th:href="@{compraSeguros}">Comprar seguros</a></li>
        <li><a th:href="@{polizasUsuarios}">Gestionar seguros</a></li>
        <li><a th:href="@{pagosUsuarios}">Gestión de Pagos</a></li>
        <li><a th:href="@{contacto}">Contacto</a></li>
      </ul>
    </nav>
  </aside>


    <main class="content">
    <header class="top-bar">
      <h1>Mis pólizas contratadas</h1>
        <a th:href="@{dashboard}">Regresar al inicio</a>    
    </header>


    <section class="filtros-section">
        <h3>Filtrar pólizas</h3>
        <form th:action="@{/clientes/polizasUsuarios}" method="get" class="filtro-form">
            <div class="filtro-group">
                <label for="estado">Estado:</label>
                <select id="estado" name="estado" class="form-select">
                    <option value="">Todos los estados</option>
                    <option value="pago pendiente" th:selected="${estado == 'pago pendiente'}">Pago Pendiente</option>
                    <option value="vigente" th:selected="${estado == 'vigente'}">Vigente</option>
                    <option value="inactiva" th:selected="${estado == 'inactiva'}">Inactiva</option>
                    <option value="cancelada" th:selected="${estado == 'cancelada'}">Cancelada</option>
                </select>
            </div>

            <div class="filtro-buttons">
                <button type="submit" class="btn btn-primary">Filtrar</button>
                <a th:href="@{/clientes/polizasUsuarios}" class="btn btn-secondary">Limpiar</a>
            </div>
        </form>
    </section>


    <section class="table-section">
      <h2>Detalle de mis pólizas</h2>
      <table id="tblMisPolizas">
    <thead>
        <tr>
            <th># Poliza</th>
            <th>Plan</th>
            <th>Inicio</th>
            <th>Fin</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        <tr th:each="poliza : ${polizas}">
            <td th:text="${poliza.id_poliza}"></td>
            <td th:text="${poliza.poliza_modelo.nombre_plan}"></td>
            <td th:text="${poliza.fecha_inicio}"></td>
            <td th:text="${poliza.fecha_fin}"></td>
            <td th:text="${poliza.estado}"></td>
            <td>
                <!-- Usar comillas simples y verificar el texto exacto -->
                <form th:if="${poliza.estado == 'pago pendiente'}"
                      th:action="@{'/misPolizas/enviarAPagos/' + ${poliza.id_poliza}}"
                      method="post">
                    <input type="hidden" name="documento" th:value="${cliente.documento}" />
                    <button type="submit" class="btn btn-primary">Ir a Pagar</button>
                </form>

                <!-- MOSTRAR "Sin acciones requeridas" para otros estados -->
                <span th:if="${poliza.estado != 'pago pendiente'}">Sin acciones requeridas</span>
            </td>
            
        </tr>
        
        <tr th:if="${#lists.isEmpty(polizas)}">
            <td colspan="6">No tienes pólizas registradas actualmente.</td>
        </tr>
    </tbody>
</table>
    </section>
  </main>


  <footer class="bottom-nav">
    <a th:href="@{dashboard}">Inicio</a>
    <a th:href="@{ayuda}">Ayuda</a>
    <a th:href="@{contacto}">Contacto</a>
    <form th:action="@{/perform_logout}" method="post">
        <input type="submit" value="Cerrar sesión" />
    </form>  
  </footer>

  
</body>
</html>
